
vertical_table_parser: &VERTICAL_TABLE_PARSER network_insight_sdk_generic_datasources.parsers.common.vertical_table_parser.VerticalTableParser
horizontal_table_parser: &HORIZONTAL_TABLE_PARSER network_insight_sdk_generic_datasources.parsers.common.horizontal_table_parser.HorizontalTableParser
generic_text_parser: &GENERIC_TEXT_PARSER network_insight_sdk_generic_datasources.parsers.common.text_parser.GenericTextParser
generation_directory: &GENERATION_DIRECTORY /tmp/uani

package_handler: &PACKAGE_HANDLER
  name: ZipPackageHandler

# workloads added will be executed in sequence
workloads: &WORKLOADS
### ARUBA 3810 TABLES
  - &NO_PAGE
    table_id: nopage
    command: no page
    parser:
      name: *GENERIC_TEXT_PARSER
      arguments:
        rules:
          page: "(.*)"

  - &SHOW_VERSION_3810
    table_id: switch
    command: show system information
    parser:
      name: *GENERIC_TEXT_PARSER
      arguments:
        rules:
          name: "System Name\\s+:\\s+(.*)"
          hostname: "System Name\\s+:\\s+(.*)"
          model: "Software revision\\s+:\\s+(.*)"

  - &MAC_ADDRESS_TABLE_3810
    table_id: mac-address-table
    command: show mac-address detail
    parser:
      pre_post_processor: Aruba3810MacAddressPrePostProcessor
      name: *HORIZONTAL_TABLE_PARSER
      arguments:
        skip_head: 4
        header_keys:
          - macAddress
          - port
          - vlan
          - age
    select_columns:
      macAddress: macAddress
      port: switchPort
      vlan: vlan

  - &LLDP_TABLE_3810
    table_id: neighbors
    command: show lldp info remote-device detail
    block_parser:
      name: GenericBlockParser
      arguments:
        line_pattern: 'Local Port\\s+:\\s\\d{1,3}/\\d{1,3}'
    parser:
      name: *GENERIC_TEXT_PARSER
      arguments:
        rules:
          localInterface: "Local Port\\s+:\\s(\\d{1,3}/\\d{1,3})"
          remoteDevice: "SysName\\s+:\\s(.*)"
          remoteInterface: "PortDescr\\s+:\\s(.*)"

  - &SHOW_IP_ROUTE_VRF_ALL_3810
    table_id: routespart1
    command: show ip route
    parser:
      name: routers_and_switches.aruba.aruba_pre_post_processor.ArubaPartialRoutesParser3810

  - &SHOW_ROUTER_INTERFACES_3810
    table_id: router-interfaces
    command: show ip
    parser:
      name: routers_and_switches.aruba.aruba_pre_post_processor.Aruba3810RouterInterfaceParser

  - &VRFS_3810
    table_id: vrfs
    command: show version
    parser:
      name: routers_and_switches.aruba.aruba_pre_post_processor.Aruba3810DefaultVrfsParser

  - &SHOW_INTERFACE1_3810
      table_id: showSwitchPorts1
      command: show interfaces ethernet all hc
      block_parser:
        name: GenericBlockParser
        arguments:
          line_pattern: "Status and Counters - Port Counters for\\s\\w+\\s\\w+.*"
      parser:
        pre_post_processor: ArubaInterfacePrePostParser3810
        name: *GENERIC_TEXT_PARSER
        arguments:
          rules:
            name: "Status and Counters - Port Counters for\\s\\w+\\s(.*)"
            connected: "Link Status\\s+:\\s(.*)"
            administrativeStatus: "Port Enabled\\s+:\\s(.*)"
            operationalStatus: "Link Status\\s+:\\s(.*)"
            hardwareAddress: "MAC Address\\s+:\\s(.*)"

  - &SHOW_INTERFACE2_3810
      table_id: showSwitchPorts2
      command: show interface status
      parser:
        name: routers_and_switches.aruba.aruba_pre_post_processor.ArubaSwitchPorts2Parser3810

  - &SHOW_LACP_3810
      table_id: showLacp
      command: show lacp
      parser:
        name: routers_and_switches.aruba.aruba_pre_post_processor.ArubaLacp3810Parser

  - &SHOW_PORT_CHANNELS_3810
    table_id: port-channels
    reuse_tables: showSwitchPorts1,showLacp
    reuse_table_processor: Aruba3810PortChannelTableProcessor

  - &SHOW_IP_ROUTE_3810
    table_id: routes
    reuse_tables: routespart1,router-interfaces
    reuse_table_processor: Aruba3810RoutesTableProcessor

### ARUBA 8320 TABLES
  - &SHOW_VERSION_8320
    table_id: switch
    command: show system
    parser:
      name: *GENERIC_TEXT_PARSER
      arguments:
        rules:
          name: "Hostname\\s+:\\s+(.*)"
          hostname: "Hostname\\s+:\\s+(.*)"
          model: "Product\\s+Name\\s+:\\s+(.*)"

  - &MAC_ADDRESS_TABLE_8320
    table_id: mac-address-table
    command: show mac-address-table detail
    parser:
      name: *HORIZONTAL_TABLE_PARSER
      arguments:
        skip_head: 5
        header_keys:
          - macAddress
          - vlan
          - type
          - port
          - denied
    select_columns:
      macAddress: macAddress
      port: switchPort
      vlan: vlan

  - &LLDP_TABLE_8320
    table_id: neighbors
    command: show lldp neighbor-info
    parser:
      name: *HORIZONTAL_TABLE_PARSER
      arguments:
        skip_head: 11
        header_keys:
          - local-port
          - chassis-id
          - port-id
          - port-desc
          - ttl
          - sys-name
    select_columns:
      local-port: localInterface
      sys-name: remoteDevice
      port-desc: remoteInterface

#  - &SHOW_IP_ROUTE_VRF_ALL_8320
#      table_id: routes
#      command: show ip route
#      block_parser:
#        name: GenericBlockParser
#        arguments:
#          line_pattern: "\\d+.\\d+.\\d+.\\d+.\\d+,\\s+vrf\\s+"
#      parser:
#        pre_post_processor: ArubaRoutePrePostParser8320
#        name: *GENERIC_TEXT_PARSER
#        arguments:
#          rules:
#            name: "(\\d+.\\d+.\\d+.\\d+.\\d+),\\s+vrf\\s+"
#            network: "(\\d+.\\d+.\\d+.\\d+.\\d+),\\s+vrf\\s+"
#            nextHop: "via\\s+([^,]+)"
#            routeType: "via\\s+[^,]+,\\s+[^,]+,\\s+(.*)"
#            interfaceName: "(\\d+.\\d+.\\d+.\\d+.\\d+),\\s+vrf\\s+"
#            vrf: "\\d+.\\d+.\\d+.\\d+.\\d+,\\s+vrf\\s+(.*)"

  - &SHOW_IP_ROUTE_VRF_ALL_8320
    table_id: routes
    command: show ip route
    parser:
      name: routers_and_switches.aruba.aruba_pre_post_processor.ArubaRoutesParser8320v1007

  - &SHOW_IP_INTERFACE_VRF_ALL_8320
      table_id: ri_vrf_mapping
      command: show ip interface brief all-vrfs
      parser:
        name: routers_and_switches.aruba.aruba_pre_post_processor.Aruba8320InterfaceTableProcessor

  - &ALL_PORTS_8320
    table_id: allPorts
    command: show interface
    block_parser:
      name: GenericBlockParser
      arguments:
        line_pattern: '\s?(Interface|Aggregate)\s+(.*)\s+is\s+(up|down)'
    parser:
      pre_post_processor: ArubaSwitchPortsAllDetailsPrePostParser8320
      name: *GENERIC_TEXT_PARSER
      arguments:
        rules:
          intname: 'Interface\s+(.*)\s+is\s+(?:up|down)'
          aggname: 'Aggregate\s+(.*)\s+is\s+(?:up|down)'
          administrativeStatus: 'Admin\s+state\s+is\s+(up|down)'
          operationalStatus: '^(?:Interface|Aggregate)\s+(?:.*)\s+is\s+(up|down)'
          connected: 'Admin\s+state\s+is\s+(up|down)'
          switchPortMode: 'VLAN\s+Mode:\s+(.*)'
          hardwareAddress: 'Hardware:\s+Ethernet,\s+MAC\s+Address:\s+(.*)'
          macAddress: 'MAC\s+Address\s+:\s*(.*)'
          interfaceSpeed: 'Speed\s+:\s+(.*)\s+Mb'
          operationalSpeed: 'Speed\s+:\s+(.*)\s+Mb'
          activePorts: 'Aggregated-interfaces\s+:\s+(.*)'
          vlans: 'Allowed\s+VLAN\s+List:\s+(.*)'
          mtu: 'MTU\s+(.*)'

  - &VRF_8320
    table_id: vrfs
    command: show vrf
    parser:
      name: *GENERIC_TEXT_PARSER
      arguments:
        rules:
          name: 'VRF\s+Name\s+:\s+(.*)'

  - &ROUTER_INTERFACE_TABLE_8320
    table_id: router-interfaces
    reuse_tables: ri_vrf_mapping,allPorts
    reuse_table_processor: Aruba8320RouterInterfaceTableProcessor

  - &SWITCH_PORT_TABLE_8320
    table_id: switch-ports
    reuse_tables: allPorts
    reuse_table_processor: Aruba8320SwitchPortTableProcessor

  - &PORT_CHANNEL_TABLE_8320
    table_id: port-channels
    reuse_tables: allPorts
    reuse_table_processor: Aruba8320PortChannelTableProcessor


table_joiners: &TABLE_JOINERS
  - &SHOW_INTERFACE_TABLE_3810
    name: network_insight_sdk_generic_datasources.joiner.table_joiner.SimpleTableJoiner
    source_table: showSwitchPorts1
    destination_table: showSwitchPorts2
    source_column: name
    destination_column: name
    joined_table_id: switch-ports

result_writer: &RESULT_WRITER
  name: CsvWriter
  table_id:
    - switch
    - mac-address-table
    - neighbors
    - routes
    - vrfs
    - router-interfaces
    - switch-ports
    - port-channels

aruba3810: !include aruba3810.yml
aruba8320: !include aruba8320.yml
